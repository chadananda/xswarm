document.addEventListener("DOMContentLoaded",()=>{const C=document.querySelectorAll("[data-delay]");document.querySelector(".terminal-lines");const S=document.querySelector(".initial-prompt");document.querySelectorAll(".typing-animation, .typing-animation-chat").forEach(e=>{e.textContent=""});let h=null;const A=()=>{h||(h=new(window.AudioContext||window.webkitAudioContext),window.audioContext=h)};function q(){if(!h)return;const e=h.createOscillator(),f=h.createGain();e.connect(f),f.connect(h.destination),e.frequency.value=800+Math.random()*400,f.gain.value=.02,e.start(),e.stop(h.currentTime+.01)}document.addEventListener("click",A,{once:!0});function w(){C.forEach(l=>{l.style.display="none",l.classList.remove("animate"),l.style.opacity="0";const s=l.querySelector(".typing-animation");s&&(s.classList.remove("active"),s.style.borderRight="2px solid var(--terminal-green)",s.textContent="");const t=l.querySelector(".typing-animation-chat");t&&(t.classList.remove("active"),t.classList.remove("typed"),t.textContent="")});const e=document.querySelector(".explosion-frame.frame-1"),f=document.querySelector(".explosion-frame.frame-2");e&&(e.style.display="block"),f&&(f.style.display="none"),S&&(S.style.display="block",S.style.opacity="1");const d=document.querySelector(".terminal-lines");d&&(d.style.display="block",d.style.opacity="1");const n=document.querySelector(".chat-interface");n&&(n.classList.remove("active"),n.querySelectorAll(".typing-animation-chat").forEach(l=>{l.textContent="",l.classList.remove("typed")}));const i=document.querySelector(".branch-creation-section");if(i){i.style.display="none",i.style.opacity="0";const l=i.querySelector(".branch-status"),s=i.querySelector(".building-animation"),t=i.querySelector(".dashboard-link");l&&(l.style.display="none"),s&&(s.style.display="none"),t&&(t.style.display="none")}}function L(){w(),C.forEach(e=>{const f=parseInt(e.getAttribute("data-delay")||"0");setTimeout(()=>{f===2e3&&S&&(S.style.display="none"),e.style.display="block",e.style.opacity="1",e.classList.add("animate");const d=e.querySelector(".typing-animation");if(d){let n=function(){if(t<i.length){d.textContent+=i[t],window.audioContext&&q();const c=i[t],x=[".",",",":",";","!","?"].includes(c);t++,x&&t<i.length?setTimeout(n,s+300+Math.random()*200):t<i.length?setTimeout(n,s):setTimeout(()=>{d.style.borderRight="none"},200)}};const i=d.getAttribute("data-text")||"",l=d.getAttribute("data-duration")||"2.5",s=parseFloat(l)*1e3/i.length;d.style.opacity="1",d.classList.add("active"),d.textContent="";let t=0;n()}if(e.classList.contains("ascii-explosion")&&setTimeout(()=>{const n=e.querySelector(".frame-1"),i=e.querySelector(".frame-2");n&&(n.style.display="none"),i&&(i.style.display="block")},300),e.classList.contains("terminal-chat-section")&&setTimeout(()=>{const n=e.querySelector(".typing-animation-chat");n&&n.classList.add("active")},500),e.classList.contains("chat-interface")){let n=function(){if(s>=l.length){setTimeout(()=>{L()},3e4);return}const t=l[s];t.style.display="block",t.style.opacity="1";const c=e.querySelector(".chat-scroll-container");c&&setTimeout(()=>{c.scrollTo({top:c.scrollHeight,behavior:"smooth"})},100);const x=t.querySelectorAll(".typing-animation-chat:not(.typed)");if(x.length>0)if(x.length>1){let r=function(){if(o<x.length){let m=function(){if(g<y.length){u.textContent+=y[g],window.audioContext&&q();const v=y[g],I=[".",",",":",";","!","?"].includes(v);g++,I&&g<y.length?setTimeout(m,T+300+Math.random()*200):g<y.length?setTimeout(m,T):(o++,setTimeout(r,300))}};const u=x[o],y=u.getAttribute("data-text")||"",b=u.getAttribute("data-duration")||"0.4",T=parseFloat(b)*1e3/y.length;u.style.display==="none"&&(u.style.display="inline"),u.classList.add("active"),u.classList.add("typed"),u.textContent="";let g=0;m()}else p&&clearInterval(p),a&&(a.style.display="none"),s++,setTimeout(n,1500)},o=0;const a=t.querySelector(".chat-cursor");a&&(a.style.display="inline-block");let p=setInterval(()=>{c&&c.scrollTo({top:c.scrollHeight,behavior:"smooth"})},500);r()}else{let r=function(){if(y<a.length){o.textContent+=a[y],window.audioContext&&q();const T=a[y],g=[".",",",":",";","!","?"].includes(T);if(y++,g&&y<a.length)setTimeout(r,m+300+Math.random()*200);else if(y<a.length)setTimeout(r,m);else{b&&clearInterval(b),u&&(u.style.display="none"),s++;const v=t.classList.contains("user-message")?2e3:1500;setTimeout(n,v)}}};const o=x[0],a=o.getAttribute("data-text")||"",p=o.getAttribute("data-duration")||"2",m=parseFloat(p)*1e3/a.length;o.classList.add("active"),o.classList.add("typed"),o.textContent="";const u=t.querySelector(".chat-cursor");u&&(u.style.display="inline-block");let y=0,b=null;c&&(b=setInterval(()=>{c.scrollTo({top:c.scrollHeight,behavior:"smooth"})},500)),r()}else if(t.querySelector(".thinking-indicator"))s++,setTimeout(n,2500);else if(t.classList.contains("agents-joining")){let r=function(){a<o.length?(o[a].style.display="block",o[a].style.opacity="1",a++,setTimeout(r,200)):(s++,setTimeout(n,1500))};const o=t.querySelectorAll(".agent-join-notification");let a=0;r()}else if(t.classList.contains("planning-stages")){let r=function(){if(a<o.length){const p=o[a];p.style.display="block",p.style.opacity="1",c&&c.scrollTo({top:c.scrollHeight,behavior:"smooth"}),setTimeout(()=>{const m=p.querySelector(".stage-indicator");m&&(m.textContent="â˜‘",p.classList.add("completed")),a++,setTimeout(r,300)},2500+Math.random()*1e3)}else s++,setTimeout(n,1e3)};const o=t.querySelectorAll(".planning-stage-notification");let a=0;r()}else if(t.classList.contains("progress-indicator")){const r=t.querySelector(".progress-dots");if(r){let o=0;setInterval(()=>{o=(o+1)%4,r.textContent=".".repeat(o)},500)}s++,setTimeout(n,5e3)}else s++,setTimeout(n,1e3)};e.classList.add("active");const i=document.querySelector(".terminal-lines");i&&(i.style.transition="opacity 0.3s ease-out",i.style.opacity="0",setTimeout(()=>{i.style.display="none"},300));const l=e.querySelectorAll(".chat-message-line, .agents-joining, .planning-stages");let s=0;l.forEach((t,c)=>{c>0&&(t.style.display="none",t.style.opacity="0")}),setTimeout(n,1500)}},f)})}L()});
